<source>
  @type forward
  @id forward_input
  tag raw.logs
</source>

<source>
  @type prometheus
  bind 0.0.0.0
  port 24231
  metrics_path /metrics
  aggregated_metrics_path /aggregated_metrics
</source>

<filter raw.logs>
  @type dedupe_with_redis
  # Plugin parameter configurations
  fields tr #msg,tr.op,tr.tid              # Example field to use for deduplication
  redis_host redis        # Redis server hostname
  redis_port 6379             # Redis server port
  ttl 300                     # Time-to-live for keys in seconds
  enable_metrics true        # Enable prometheus metrics
  drop_duplicates false        # Drop duplicate log lines
  bucket_size 3         # Maximum count within the dedupe bucket
  <labels>
    source $.dep
  </labels>
</filter>

# <match dedupe.raw.logs>
<match dedupe.**>
  @type file
  path /var/log/output.log
  <format>
    @type "json"
  </format>
</match>

<match raw.logs>
  @type file
  path /var/log/output2.log
  <format>
    @type "json"
  </format>
</match>